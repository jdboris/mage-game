[gd_scene load_steps=13 format=2]

[ext_resource path="res://states/motion/idle.gd" type="Script" id=1]
[ext_resource path="res://mobs/skeleton_warrior_state_machine.gd" type="Script" id=2]
[ext_resource path="res://models/skeleton_warrior.tscn" type="PackedScene" id=3]
[ext_resource path="res://states/motion/moving.gd" type="Script" id=4]
[ext_resource path="res://modules/melee_ai_input.gd" type="Script" id=5]
[ext_resource path="res://modules/props/float_prop.gd" type="Script" id=6]
[ext_resource path="res://modules/ui/mob_ui.tscn" type="PackedScene" id=7]
[ext_resource path="res://states/dead.gd" type="Script" id=8]
[ext_resource path="res://modules/mob_hurtbox/mob_hurtbox.tscn" type="PackedScene" id=9]
[ext_resource path="res://states/combat/attack.gd" type="Script" id=10]

[sub_resource type="BoxShape" id=3]
extents = Vector3( 0.627, 1, 0.484 )

[sub_resource type="SphereShape" id=4]
radius = 10.0

[node name="SkeletonWarrior" type="KinematicBody"]
collision_layer = 16
collision_mask = 28

[node name="Props" type="Node" parent="."]

[node name="Health" type="Node" parent="Props"]
script = ExtResource( 6 )
max_value = 100.0
value = 100.0

[node name="ModelPivot" type="Spatial" parent="."]

[node name="character_skeleton_warrior" parent="ModelPivot" instance=ExtResource( 3 )]

[node name="Skeleton" parent="ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/KayKit Animated Character" index="0"]
bones/0/bound_children = [  ]
bones/1/bound_children = [  ]
bones/2/bound_children = [  ]
bones/3/bound_children = [  ]
bones/4/bound_children = [  ]
bones/5/bound_children = [  ]

[node name="Head" parent="ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/KayKit Animated Character/Skeleton" index="0"]
transform = Transform( 0.999866, 0.00121577, 0.0163309, -0.00107147, 0.99996, -0.00884175, -0.016341, 0.00882306, 0.999828, 0, 0.711598, 0 )

[node name="Body" parent="ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/KayKit Animated Character/Skeleton" index="1"]
transform = Transform( 0.998468, 0, 0.055331, 0, 1, 0, -0.055331, 0, 0.998468, 0, 0, 0 )

[node name="ArmLeft" parent="ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/KayKit Animated Character/Skeleton" index="2"]
transform = Transform( -0.056123, 0.47477, -0.878319, -0.00148824, -0.879744, -0.475445, -0.998423, -0.0253762, 0.0500804, 0.139786, 0.691598, -0.00774634 )

[node name="ArmRight" parent="ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/KayKit Animated Character/Skeleton" index="3"]
transform = Transform( -0.111807, -0.490231, -0.864392, -0.00337969, -0.869653, 0.493652, -0.993724, 0.058115, 0.0955761, -0.139587, 0.690497, 0.0126058 )

[node name="HandSlotLeft" parent="ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/KayKit Animated Character/Skeleton" index="4"]
transform = Transform( -0.998416, 0.056123, -0.00406227, -0.00398496, 0.00148861, 0.999991, 0.0561284, 0.998423, -0.00126258, 0.401347, 0.206928, -0.0217267 )

[node name="HandSlotRight" parent="ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/KayKit Animated Character/Skeleton" index="5"]
transform = Transform( -0.99523, 0.0720441, 0.0657813, 0.0641355, -0.0249274, 0.99763, 0.0735131, 0.99709, 0.0201879, -0.409666, 0.211386, 0.0446226 )

[node name="CollisionShape" type="CollisionShape" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.00129247, 1.01194, 0.000229836 )
shape = SubResource( 3 )

[node name="AggroArea" type="Area" parent="."]
visible = false
collision_layer = 0
collision_mask = 4

[node name="CollisionShape" type="CollisionShape" parent="AggroArea"]
shape = SubResource( 4 )

[node name="MobHurtbox" parent="." instance=ExtResource( 9 )]
_ai_input = NodePath("../MeleeAiInput")
_state_machine = NodePath("../StateMachine")
_mob_health = NodePath("../Props/Health")

[node name="MeleeAiInput" type="Node" parent="."]
script = ExtResource( 5 )

[node name="StateMachine" type="Node" parent="."]
script = ExtResource( 2 )
_ai_input = NodePath("../MeleeAiInput")
dead = NodePath("Dead")
attack = NodePath("Attack")

[node name="Idle" type="Node" parent="StateMachine"]
script = ExtResource( 1 )
animation_player = NodePath("../../ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/AnimationPlayer")
moving = NodePath("../Moving")
idle_animation = "Idle"

[node name="Moving" type="Node" parent="StateMachine"]
script = ExtResource( 4 )
animation_player = NodePath("../../ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/AnimationPlayer")
moving = NodePath(".")
walk_animation = "Run"
idle = NodePath("../Idle")
max_walk_speed = 2

[node name="Attack" type="Node" parent="StateMachine"]
script = ExtResource( 10 )
animation_player = NodePath("../../ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/AnimationPlayer")
attack_animation = "Attack(1h)"

[node name="Dead" type="Node" parent="StateMachine"]
script = ExtResource( 8 )
animation_player = NodePath("../../ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/AnimationPlayer")
death_animation = "Defeat"

[node name="MobUi" parent="." instance=ExtResource( 7 )]

[connection signal="value_changed" from="Props/Health" to="StateMachine" method="_on_Health_value_changed"]
[connection signal="value_changed" from="Props/Health" to="MobUi" method="_on_Health_value_changed"]
[connection signal="animation_finished" from="ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12/AnimationPlayer" to="StateMachine/Attack" method="_on_AnimationPlayer_animation_finished"]
[connection signal="body_entered" from="AggroArea" to="MeleeAiInput" method="set_target"]
[connection signal="input" from="MeleeAiInput" to="StateMachine" method="_unhandled_input"]
[connection signal="entered" from="StateMachine/Dead" to="CollisionShape" method="set_disabled" binds= [ true ]]
[connection signal="entered" from="StateMachine/Dead" to="MobHurtbox" method="set_monitorable" binds= [ false ]]
[connection signal="entered" from="StateMachine/Dead" to="MobHurtbox" method="set_monitoring" binds= [ false ]]
[connection signal="entered" from="StateMachine/Dead" to="AggroArea" method="set_monitorable" binds= [ false ]]
[connection signal="entered" from="StateMachine/Dead" to="AggroArea" method="set_monitoring" binds= [ false ]]

[editable path="ModelPivot/character_skeleton_warrior"]
[editable path="ModelPivot/character_skeleton_warrior/KayKit_AnimatedCharacter_v12"]
